<script>
document.addEventListener("DOMContentLoaded", function () {
  var map = L.map("map").setView([34.971, 138.3889], 16);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 19,
    attribution: "© OpenStreetMap contributors"
  }).addTo(map);

  Papa.parse("test.csv", {
    download: true,
    header: true,
    complete: function (results) {
      console.log("CSV読み込み結果:", results.data);

      results.data.forEach(function (row) {
        console.log("処理中の行:", row);

        var lat = parseFloat(row["緯度"]);
        var lng = parseFloat(row["経度"]);
        var info = row["情報名"];
        var date = row["受信日"];
        var status = row["状態"];

        if (!isNaN(lat) && !isNaN(lng)) {
          var marker = L.marker([lat, lng]).addTo(map);
          marker.bindPopup(
            `<b>${info}</b><br>受信日: ${date}<br>状態: ${status}`
          );
        } else {
          console.warn("座標が不正のためスキップ:", row);
        }
      });
    }
  });
});
</script>
